# 关系型数据库

## 锁

表级锁

行级锁

页面锁

## 0x05 性能优化切入点

应用的切入点也比较简单和暴力：

1. 优化应用层面的查询。
2. 优化数据库的 SQL 查询。
3. 优化数据库的存储结构。
4. 优化单个数据库服务器的性能。
5. 遵循『机多运算大』的原则，上几台机器。
6. 更好的机器，即加内存条，上好的 CPU。

优化前三点，则需要理解取数据的客户端从发送 SQL 语句到接受数据之间都发生了什么？流程如下：

1. 开启连接
2. 发送查询给服务器
3. 分析查询
4. 执行查询
5. 传输数据
6. 关闭连接

### 优化应用层面的查询

在同样工作量的情况下不断的减少数据库的连接，将多个动作放在一起使用 TRANSACTION 可以显著提高速度。

1. 对于 OLTP 类型的数据库设计的数据库，一些耗时查询往往是可以在应用层面查询进行优化的，比如在手写代码应用级缓存，借助外部组件 (redis) 应用内缓存。
2. 对于一些有性能要求的场景，不要使用 select * from xxx 这种查询，服务器到客户端传输也是需要时间的，而是要选择需要的字段。
3. 如果有必要，不要在循环内部进行数据库查询，而是直接取出来放在内存中进行运算。学过的算法与数据结构用起来！!

### 优化数据库的 SQL 查询

如同前文所见，到了 SQL 命令这层切入点能够优化的地方只有步骤 4.

对于查找，效率取决于：

1. 取记录数量
2. 搜索到这些记录的时间。

对于插入，执行查询则插入记录和更新索引两个部分，也是插入的瓶颈所在：

1. 插入记录 速度取决于记录数量，记录大小
2. 更新索引 速度取决于索引数量。

对于更新，执行查询则有查找，更新记录和更新索引两个部分，也是更新的瓶颈所在：

1. 查找 需要参考查找
2. 更新记录 速度取决于记录数量，记录大小
3. 更新索引 速度取决于更新索引字段的数量。

对于删除，执行查询则有查找，删除记录和删除索引两个部分，也是删除的瓶颈所在：

1. 查找 需要参考查找
2. 删除记录 速度取决于记录数量，记录大小
3. 更新索引 速度取决于更新索引字段的数量。

### 查询的优化

### 索引的代价

> 在计算机这个神奇的世界里面，没有一个算法与数据结构的挑选是没有代价的。便于查询，则不便于插入更新。

有的人把索引比作字典。说字典的索引页面就好像是数据表中的索引。

这个比方很贴切，可以用在索引的比方上，也可以用在索引的代价上。

- 一个没有索引的页面，即是一个只有页码，编号的字典。当我们查询一个新字的时候，只能从第一页翻到结尾，效率很低。
- 一个有一个索引的页面，即是一个有页码，编号，拼音索引的字典。当我们查询一个新字的时候，先查询索引，然后从索引查页码，于是很快找到字。当我们**增加 / 删除 / 更新**一个字之后，还需要更新拼音索引。
- 一个有多个索引的页面，即是一个有页码，编号，拼音索引和部首索引以及其他索引的字典。当我们**增加 / 删除 / 更新**一个字之后，还需要更新拼音索引，部首索引等等索引。

> 计算机世界就是这样，没有完美的算法，也没有完美的模型。

### 数据存储结构

### 硬件优化

留空，这个可能比较接近运维或者 DBA 的工作

### 配置优化

留空，这个可能比较接近运维或者 DBA 的工作

## 0x06 常见问题

### 密码忘了怎么办？

    /etc/init.d/mysql stopmysqld_safe --skip-grant-tables &# 在另一个终端 输入 mysql 进入终端在另一端执行 SQL 命令 UPDATE mysql.user SET password=PASSWORD('nouveau') WHERE user='root';## Kill mysqld_safe from the terminal, using Control + \/etc/init.d/mysql start

## 0xEE 参考链接

关于 SQL 与数据库的有趣解释

1. [Inner Join 和 Outer Join](http://stackoverflow.com/questions/38549/what-is-the-difference-between-inner-join-and-outer-join)
2. [如何防止 SQL 注入](http://stackoverflow.com/questions/60174/how-can-i-prevent-sql-injection-in-php)
3. [索引是怎么工作的](http://stackoverflow.com/questions/1108/how-does-database-indexing-work)
4. [Mysql 常用 SQL 语句集锦（本文部分 SQL 语句取自此博文）](https://gold.xitu.io/post/584e7b298d6d81005456eb53)

http://stackoverflow.com/questions/194852/concatenate-many-rows-into-a-single-text-string
